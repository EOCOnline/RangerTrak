<pageHeader [parentTitle]="title">...</pageHeader>
<div id="SettingsBody" class="container">
  <form [formGroup]="settingsEditorForm" (ngSubmit)="onFormSubmit()">
    <br />
    <details>
      <summary>Instructions</summary>
      <ul>
        <li>
          When starting a new event:
          <ul>
            <li>
              Remove leftover "Field Reports" from previous operational periods or
              exercises.
              <br />
              Do so at the bottom of the Field Reports page.
            </li>
            <li>
              Update the list of Rangers on the Rangers page. <br />
              (Minor updates and new rangers can be added throughout the event.)
            </li>
            <li>
              As soon as practical, either reset all settings (see Advanced Options below)
              -- <br />
              or just edit the following settings
            </li>
          </ul>
        </li>

        <li>
          Settings are (manually) saved to and automatically restored from this browser's
          local storage.
        </li>
        <li>
          Each browser on each device maintains its own Local Storage: they are not
          shared.
        </li>
        <li>
          If nothing has been saved, or the user selects "Reset Values", then hardcoded
          values are used.
        </li>
        <li>
          Browser local storage contents are viewable using a browser's developer tools:
          F12
        </li>
        <li>
          Change font size using CTRL+mouse wheel or your browser's view size settings.
        </li>
      </ul>
    </details>

    <br />
    <h2>Event Information</h2>
    <div class="input-group">
      <span class="strong">Mission: </span>
      <input
        formControlName="mission"
        placeholder="Mission #"
        [style.width.px]="100"
        type="text"
        data-lpignore="true"
      />
    </div>

    <div class="input-group">
      <span class="strong">Event Name: </span>
      <input
        formControlName="event"
        placeholder="Event Name"
        [style.width.px]="100"
        type="text"
        data-lpignore="true"
      />
    </div>

    <div class="input-group">
      <span class="strong">Event Notes: </span><br />
      <textarea
        appearance="fill"
        formControlName="eventNotes"
        id=""
        cols="60"
        rows="4"
        placeholder="Event description, if needed"
      ></textarea>
    </div>

    <div class="input-group">
      <span class="strong">OpPeriod Name: </span>
      <input
        formControlName="opPeriod"
        placeholder="Operational Period"
        [style.width.px]="120"
        type="text"
        data-lpignore="true"
      />
    </div>

    <div class="input-group">
      <span class="strong">OpPeriod Start: </span>
      <input
        formControlName="opPeriodStart"
        placeholder="Start Time"
        [style.width.px]="100"
        type="text"
        data-lpignore="true"
      />
    </div>

    <div class="input-group">
      <span class="strong">OpPeriod End: </span>
      <input
        formControlName="opPeriodEnd"
        placeholder="Ending Time"
        [style.width.px]="100"
        type="text"
        data-lpignore="true"
      />
    </div>
    <br />

    <h2>Location Defaults</h2>
    <!--legend>Default </legend-->
    <details>
      <summary><span class="strong">Location Guidance</span></summary>
      <ul>
        <li>This sets initial (default) values for lat & long in the entry form.</li>
        <li>
          What3Words uses this to set the focus, prioritizing suggested results (for
          incorrect words) by proximity to this point.
        </li>
        <li>PlusCodes uses this for converting short to full/global codes.</li>
        <li>
          Maps do not use this. They are auto-centered on the bounding coordinates
          centroid of all points entered and the map is then zoomed to show all points.
        </li>
      </ul>
    </details>
    <div class="input-group">
      <span class="strong">Latitude: &nbsp;</span>
      <input
        [class.border-danger]="settingsEditorForm.get('defLat')?.touched && settingsEditorForm.get('defLat')?.invalid"
        type="number"
        formControlName="defLat"
        placeholder="{{settings?.defLat?.toFixed(4)}}"
        value="{{settings?.defLat?.toFixed(4)}}"
        [style.width.px]="60"
        data-lpignore="true"
      />
      <div
        *ngIf="settingsEditorForm.get('defLat')?.touched && settingsEditorForm.get('defLat')?.hasError('required')"
        class="text-sm text-danger"
      >
        latitude is required
      </div>
    </div>

    <div class="input-group">
      <span class="strong">Longitude: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('defLng')?.touched && settingsEditorForm.get('defLng')?.invalid"
        type="number"
        formControlName="defLng"
        placeholder="{{settings!.defLng?.toFixed(4)}}"
        [style.width.px]="60"
        data-lpignore="true"
      />
      <div
        *ngIf="settingsEditorForm.get('defLng')?.touched && settingsEditorForm.get('defLng')?.hasError('required')"
        class="text-sm text-danger"
      >
        longitude is required
      </div>
    </div>

    <div class="input-group">
      <span class="strong">Plus Code: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('defPlusCode')?.touched && settingsEditorForm.get('defPlusCode')?.invalid"
        type="text"
        formControlName="defPlusCode"
        placeholder="84VVCGWP+VW"
        [style.width.px]="100"
        data-lpignore="true"
      />
      <div
        *ngIf="settingsEditorForm.get('defPlusCode')?.touched && settingsEditorForm.get('defPlusCode')?.hasError('required')"
        class="text-sm text-danger"
      >
        plusCode is required
      </div>
    </div>

    <div class="input-group">
      <span class="strong">w3wLocale: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('w3wLocale')?.touched && settingsEditorForm.get('w3wLocale')?.invalid"
        type="text"
        formControlName="w3wLocale"
        placeholder="Vashon, WA"
        [style.width.px]="100"
        data-lpignore="true"
      />
      <div
        *ngIf="settingsEditorForm.get('w3wLocale')?.touched && settingsEditorForm.get('w3wLocale')?.hasError('required')"
        class="text-sm text-danger"
      >
        plusCode is required
      </div>
    </div>
    <br />
    <h2>Maps</h2>

    <div class="input-group">
      <span class="strong">Markers: </span>
      <input
        type="checkbox"
        formControlName="allowManualPinDrops"
        placeholder="allowManualPinDrops"
      />
      Should clicks on Google & Leaflet <br />
      Maps show up as new markers?
    </div>
    <br />

    <h3>Leaflet Map Settings</h3>
    <!-- div [form   Group]="settingsEditorForm" -->
    <div class="input-group">
      <span class="strong">Default Zoom: </span>
      <!-- BUG:

      Cannot find control with name: 'leaflet.defZoom'

      22:21:33:0816 - From Settings Component - Application: RangerTrak
      -- Version: 0.11.38 log.service.ts:30
      22:21:33:0817 - From Settings Component -
      getFormArrayFromSettingsArray log.service.ts:30
      22:21:33:0818 - From Settings
      Component - ngInit done core.mjs:6485
      ERROR Error:  at _throwError
      (forms.mjs:1794:11) at setUpControl
      (forms.mjs:1574:13) at FormGroupDirective.addControl
      (forms.mjs:5350:9) at FormControlName._setUpControl
      (forms.mjs:5912:43) at FormControlName.ngOnChanges
      (forms.mjs:5857:18) at FormControlName.rememberChangeHistoryAndInvokeOnChangesHook
      (core.mjs:1508:1) at callHook
      (core.mjs:2552:1) at callHooks
      (core.mjs:2511:1) at executeInitAndCheckHooks
      (core.mjs:2462:1) at selectIndexInternal (core.mjs:8405:1)
    -->
      <input
        formControlName="leaflet.defZoom"
        placeholder="15"
        type="number"
        [style.width.px]="50"
      />
    </div>

    <!-- markerScheme - unused for now -->

    <div class="input-group">
      <span class="strong">Overview Map Zoom Difference: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('leaflet.overviewDifference')?.touched && settingsEditorForm.get('leaflet.overviewDifference')?.invalid"
        type="number"
        [style.width.px]="50"
        formControlName="leaflet.overviewDifference"
        placeholder="5"
      />
      <div
        *ngIf="settingsEditorForm.get('leaflet.overviewDifference')?.touched && settingsEditorForm.get('leaflet.overviewDifference')?.hasError('required')"
        class="text-sm text-danger"
      >
        overviewDifference is required
      </div>
    </div>

    <div class="input-group">
      <span class="strong">Overview Map Min Zoom: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('leaflet.overviewMinZoom')?.touched && settingsEditorForm.get('leaflet.overviewMinZoom')?.invalid"
        type="number"
        formControlName="leaflet.overviewMinZoom"
        placeholder="5"
      />
      <div
        *ngIf="settingsEditorForm.get('leaflet.overviewMinZoom')?.touched && settingsEditorForm.get('leaflet.overviewMinZoom')?.hasError('required')"
        class="text-sm text-danger"
      >
        leaflet.overviewMinZoom is required
      </div>
    </div>

    <div class="input-group">
      <span class="strong">Overview Map Max Zoom: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('leaflet.overviewMaxZoom')?.touched && settingsEditorForm.get('leaflet.overviewMaxZoom')?.invalid"
        type="number"
        [style.width.px]="50"
        formControlName="leaflet.overviewMaxZoom"
        placeholder="21"
      />
      <div
        *ngIf="settingsEditorForm.get('leaflet.overviewMaxZoom')?.touched && settingsEditorForm.get('leaflet.overviewMaxZoom')?.hasError('required')"
        class="text-sm text-danger"
      >
        leaflet.overviewMaxZoom is required
      </div>
    </div>
    <br />

    <h3>Google Map Settings</h3>
    <div class="input-group">
      <span class="strong">Default Zoom: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('google.defZoom')?.touched && settingsEditorForm.get('google.defZoom')?.invalid"
        type="number"
        [style.width.px]="50"
        formControlName="google.defZoom"
        placeholder="15"
      />
      <div
        *ngIf="settingsEditorForm.get('google.defZoom')?.touched && settingsEditorForm.get('google.defZoom')?.hasError('required')"
        class="text-sm text-danger"
      >
        google.zoom is required
      </div>
    </div>

    <!-- markerScheme - unused for now -->

    <div class="input-group">
      <span class="strong">Overview Map Zoom Difference: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('google.overviewDifference')?.touched && settingsEditorForm.get('google.overviewDifference')?.invalid"
        type="number"
        [style.width.px]="50"
        formControlName="google.overviewDifference"
        placeholder="5"
      />
      <div
        *ngIf="settingsEditorForm.get('google.overviewDifference')?.touched && settingsEditorForm.get('google.overviewDifference')?.hasError('required')"
        class="text-sm text-danger"
      >
        overviewDifference is required
      </div>
    </div>

    <div class="input-group">
      <span class="strong">Overview Map Min Zoom: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('google.overviewMinZoom')?.touched && settingsEditorForm.get('google.overviewMinZoom')?.invalid"
        type="number"
        [style.width.px]="50"
        formControlName="google.overviewMinZoom"
        placeholder="5"
      />
      <div
        *ngIf="settingsEditorForm.get('google.overviewMinZoom')?.touched && settingsEditorForm.get('google.overviewMinZoom')?.hasError('required')"
        class="text-sm text-danger"
      >
        google.overviewMinZoom is required
      </div>
    </div>

    <div class="input-group">
      <span class="strong">Overview Map Max Zoom: </span>
      <input
        [class.border-danger]="settingsEditorForm.get('google.overviewMaxZoom')?.touched && settingsEditorForm.get('google.overviewMaxZoom')?.invalid"
        type="number"
        [style.width.px]="50"
        formControlName="google.overviewMaxZoom"
        placeholder="21"
      />
      <div
        *ngIf="settingsEditorForm.get('google.overviewMaxZoom')?.touched && settingsEditorForm.get('google.overviewMaxZoom')?.hasError('required')"
        class="text-sm text-danger"
      >
        google.overviewMaxZoom is required
      </div>
    </div>
    <br />

    <h2>Field Report Statuses</h2>
    (Don't edit status names - if they've already <br />
    been used for this event.<br />
    Add new statuses anytime.)

    <ag-grid-angular
      class="ag-theme-alpine"
      (gridReady)="onGridReady($event)"
      [gridOptions]="gridOptions"
      [defaultColDef]="defaultColDef"
      [tooltipShowDelay]="500"
      [rowData]="rowData"
      [columnDefs]="columnDefs"
    >
    </ag-grid-angular>

    <button (click)="onBtnAddFRStatus()" title="Add a new Field Report Status">
      Add new row
    </button>
    &nbsp;&nbsp;&nbsp;
    <button (click)="this.refreshStatusGrid()" title="Refresh Report Statuses">
      Refresh Statuses Grid
    </button>
    <br />

    <br />
    <h2>Debug</h2>

    <div class="input-group">
      <input type="checkbox" formControlName="debugMode" placeholder="debugMode" />
      <span class="strong">Debug Mode</span>
    </div>

    <!-- TODO: future: [ ] enable touch user interface<br>-->

    <br />

    <span class="strong">Save above settings: </span>
    <button [disabled]="settingsEditorForm.invalid" type="submit">Save</button>

    <br />
    <br />

    <details>
      <summary><span class="big">Advanced Options</span></summary>
      <span class="strong"
        >At the start of a new Incident or Exercise edit the settings above, <br />
        or just reset all settings to their default value:
      </span>
      <button (click)="onBtnResetDefaults()">Reset Settings</button><br />
      <br />
      <h2>
        <a
          href="https://fonts.google.com/share?selection.family=Open+Sans%7CMontserrat%7CRoboto%7CPlayfair+Display%7CLato%7CMerriweather%7CHelvetica%7CLora%7CPT+Serif%7CSpectral%7CTimes+New+Roman%7CAkaya+Telivigala%7COpen+Sans+Condensed%7CSaira+Extra+Condensed%7CBoogaloo%7CAnton%7CFaster+One%7CArima+Madurai"
          target="_blank"
          >Font Explorium</a
        >
      </h2>
      <ul style="font-size: large;">
        <li *ngFor="let font of fonts">
          {{font}}: <span style="font-family: {{font}};">{{pangram}}</span>
        </li>
      </ul>
    </details>
  </form>
</div>
